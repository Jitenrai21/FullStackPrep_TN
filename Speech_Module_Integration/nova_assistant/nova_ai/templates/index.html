<!DOCTYPE html>
<html>
<head>
    <title>Nova Assistant</title>
</head>
<body>
    <h1>Nova is Listening...</h1>
    <button onclick="startRecognition()">Start Assistant</button>
    <p id="output">Say "Nova" to wake.</p>

<script>
    let recognizing = false;
    let recognition;
    const synth = window.speechSynthesis;

    function say(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.voice = synth.getVoices().find(voice => voice.name.includes("Google US English")) || synth.getVoices()[0];
        synth.speak(utterance);
    }

    function startRecognition() {
        if (!('webkitSpeechRecognition' in window)) {
            alert('Speech recognition not supported');
            return;
        }

        recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onresult = function(event) {
            const result = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
            document.getElementById("output").innerText = "You said: " + result;

            if (result.includes("nova")) {
                say("Hi Sir, how can I help you?");
            } else {
                fetch(`/get-response/?query=${encodeURIComponent(result)}`)
                    .then(res => res.json())
                    .then(data => {
                        say(data.response);
                        document.getElementById("output").innerText = "Nova: " + data.response;
                    });
            }
        };

        recognition.onerror = function(e) {
            console.error('Recognition error:', e);
        };

        recognition.onend = function() {
            if (recognizing) recognition.start();
        };

        recognition.start();
        recognizing = true;
        say("Nova assistant activated, say 'Nova' to wake me.");
    }
</script>
</body>
</html>
